<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ノジマ 柏モディおみくじ</title>
  <style>
    /* 全体レイアウト */
    body {
      font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      background: #1a1a1a;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      font-size: 28px;
      color: #ffb400;
      text-shadow: 0 0 10px rgba(255,180,0,0.5);
    }

    /* 動画コンテナ */
    .video-container {
      width: 100%;
      max-width: 640px;
      margin: 20px auto;
      aspect-ratio: 16 / 9;
      background: #000;
      border: 3px solid #ff6f61;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* 結果表示エリア */
    #result-label {
      font-size: 24px;
      font-weight: bold;
      margin: 20px 0;
      min-height: 1.5em;
      color: #ff6f61;
    }

    /* ボタンエリア */
    #action-area {
      min-height: 60px;
    }

    .btn {
      font-size: 18px;
      padding: 15px 35px;
      border: none;
      border-radius: 50px;
      color: #fff;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      margin: 0 auto 10px auto;
    }

    /* 引くボタン */
    #draw-btn {
      background-color: #ff6f61;
      box-shadow: 0 4px 15px rgba(255, 111, 97, 0.4);
    }
    #draw-btn:hover { background-color: #ff4f40; }
    #draw-btn:disabled { background-color: #555; cursor: not-allowed; opacity: 0.7; }

    /* トップに戻るボタン */
    #back-btn {
      background-color: #3498db;
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
      display: none;
    }
    #back-btn:hover { background-color: #2980b9; }

    /* 注釈 */
    .footer-note {
      margin-top: 40px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>

  <h1>ノジマ 柏モディおみくじ</h1>
  
  <div class="video-container">
    <video id="omikuji-video" playsinline muted autoplay loop>
      <source id="video-source" src="./waiting.mp4" type="video/mp4">
      ブラウザが動画再生に対応していません。
    </video>
  </div>

  <div id="result-label">ボタンを押してね</div>

  <div id="action-area">
    <button id="draw-btn" class="btn" onclick="drawOmikuji()">おみくじを引く！</button>
    <button id="back-btn" class="btn" onclick="backToTop()">トップ画面に戻る</button>
  </div>

  <p class="footer-note">※このおみくじは確率に基づいて抽選を行っています</p>

  <script>
    // --- 1. 確率設定（合計100になるように設定） ---
    const fortuneSettings = [
      { name: "大吉", probability: 1,  src: "./daikichi.mp4" },
      { name: "吉",   probability: 2,  src: "./kichi.mp4" },
      { name: "中吉", probability: 9,  src: "./chukichi.mp4" },
      { name: "小吉", probability: 88, src: "./shokichi.mp4" }
    ];

    const video = document.getElementById('omikuji-video');
    const drawBtn = document.getElementById('draw-btn');
    const backBtn = document.getElementById('back-btn');
    const resultLabel = document.getElementById('result-label');

    // --- 2. トップに戻る関数 ---
    function backToTop() {
      resultLabel.textContent = "ボタンを押してね";
      backBtn.style.display = 'none';
      drawBtn.style.display = 'inline-block';
      drawBtn.disabled = false;

      video.loop = true;
      video.muted = true;
      video.src = "./waiting.mp4";
      video.load();
      video.play().catch(e => console.error("再生失敗:", e));
    }

    // --- 3. 抽選関数（確率ベース） ---
    async function drawOmikuji() {
      drawBtn.disabled = true;
      resultLabel.textContent = "抽選中...";

      // 0〜99の乱数を生成
      const randomValue = Math.floor(Math.random() * 100);
      
      let selectedFortune = null;
      let currentThreshold = 0;

      // 確率判定ロジック
      for (const fortune of fortuneSettings) {
        currentThreshold += fortune.probability;
        if (randomValue < currentThreshold) {
          selectedFortune = fortune;
          break;
        }
      }

      // 動画の切り替え
      video.loop = false;
      video.muted = false;
      video.src = selectedFortune.src;
      video.load();
      
      try {
        await video.play();
        
        video.onended = () => {
          resultLabel.textContent = `結果：${selectedFortune.name}！`;
          drawBtn.style.display = 'none';
          backBtn.style.display = 'inline-block';
        };
      } catch (err) {
        console.error("再生エラー:", err);
        resultLabel.textContent = `結果：${selectedFortune.name} (再生エラー)`;
        drawBtn.disabled = false;
      }
    }
  </script>

</body>
</html>